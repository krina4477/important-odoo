<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_order_form_inherited" model="ir.ui.view">
        <field name="name">sale.order.form.inherited</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='order_line']/tree/control" position="inside">
                <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'order_id': parent.id}"/>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='product_template_id']"
                   position="after">
                <field name="product_barcode"/>
            </xpath>
        </field>
    </record>

    <record id="view_purchase_order_form_inherited" model="ir.ui.view">
        <field name="name">purchase.order.form.inherited</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='order_line']/tree/control" position="inside">
                <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'order_id': parent.id}"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="after">
                <field name="product_barcode"/>
            </xpath>
        </field>
    </record>

    <record id="view_inventory_adjustment_form_inherited" model="ir.ui.view">
        <field name="name">inventory.adjustment.form.inherited</field>
        <field name="model">inventory.adjustment.template.new</field>
        <field name="inherit_id" ref="inventory_adjustment_template.view_inventory_adjustments_temp_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='adjst_line_ids']/tree" position="inside">

                <control>
                     <create name="add_product_control" string="Add a product"/>
                    <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'inventory_id': parent.id}"/>
                </control>
            </xpath>
<!--            <xpath expr="//field[@name='adjst_line_ids']/tree/field[@name='product_id']" position="after">-->
<!--                <field name="product_barcode"/>-->
<!--            </xpath>-->
        </field>
    </record>

    <record id="view_custom_warehouse_stock_request_form_view" model="ir.ui.view">
        <field name="name">warehouse.stock.form.inherited</field>
        <field name="model">custom.warehouse.stock.request</field>
        <field name="inherit_id" ref="hemfa_warehouse_stock_request.custom_warehouse_stock_request_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='warehouse_stock_request_line_ids']/tree" position="inside">
                <control>
                     <create name="add_product_control" string="Add a product"/>
                    <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'stock_request_id': parent.id}"/>
                </control>
            </xpath>
            <xpath expr="//field[@name='warehouse_stock_request_line_ids']/tree/field[@name='product_id']" position="after">
                <field name="product_barcode"/>
            </xpath>
        </field>
    </record>

     <record id="account_move_form_view" model="ir.ui.view">
        <field name="name">account.move.form.inherited</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='invoice_line_ids']/tree/control" position="inside">
                <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'move_id.': parent.id}"/>
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='product_id']" position="after">
                <field name="product_barcode"/>
            </xpath>
        </field>
    </record>

    <record id="stock_move_line_form_view" model="ir.ui.view">
        <field name="name">stock.move.form.inherited</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='move_ids_without_package']/tree" position="inside">
                <control>
                     <create name="add_product_control" string="Add a product"/>
                    <button name="action_add_from_catalog" string="Catalog" type="object" class="px-4 btn-link"
                        context="{'picking_id ': parent.id}"/>
                </control>
            </xpath>
            <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_id']" position="after">
                <field name="product_barcode"/>
            </xpath>
        </field>
    </record>

    <record id="product_view_kanban_catalog" model="ir.ui.view">
        <field name="name">product.view.kanban.catalog</field>
        <field name="model">product.product</field>
        <field name="arch" type="xml">
            <kanban records_draggable="0" js_class="product_kanban_catalog">
                <field name="id" invisible="1"/>
                <field name="default_code" invisible="1"/>
                <templates>
                    <t t-name="kanban-menu">
                        <div class="o_product_catalog_cancel_global_click">
                            <a role="menuitem" type="edit" class="dropdown-item border-top-0">Edit</a>
                        </div>
                    </t>
                    <t t-name="kanban-box">
                        <div class="d-flex flex-grow-1">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('product.product', 'image_128', record.id.raw_value)"
                                     alt="Product"/>
                            </div>
                            <div class="oe_kanban_details p-2 d-flex">
                                <div class="o_kanban_record_top flex-column m-0"
                                     t-attf-id="product-{{record.id.raw_value}}">
                                    <div class="d-flex">
                                        <field style="margin-top: 2px;" class="me-1" name="priority" widget="priority"/>
                                        <h4 class="text-reset">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                        </h4>
                                    </div>
                                    <div t-if="record.default_code.value">
                                        [<field name="default_code"/>]
                                    </div>
                                    <!-- Used by @web/product/js/product_catalog/order_line to
                                         show the price using a t-portal. -->
                                    <div name="o_kanban_price"
                                         t-attf-id="product-{{record.id.raw_value}}-price"
                                         class="d-flex flex-column"/>
                                    <field name="product_template_attribute_value_ids"
                                           widget="many2many_tags"
                                           domain="[('id', 'in', parent.ids)]"
                                           groups="product.group_product_variant"
                                           options="{'color_field': 'color'}"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="product_view_search_catalog" model="ir.ui.view">
        <field name="name">product.view.search.catalog</field>
        <field name="model">product.product</field>
        <field name="arch" type="xml">
            <search string="Product">
                <!-- Search field -->
                <field name="name"
                       string="Product"
                       filter_domain="['|',('barcode', 'ilike', self),('barcode_line_ids.name', 'ilike', self)]"/>
            </search>
        </field>
    </record>
</odoo>